{% extends "base.html" %}

{% block title %}
  Add Item
{% endblock %}

{% block page_content %}
    <div class="video-window">
        <button onclick="open_personal_popup()">Personal Items</button>
        <button onclick="open_search_popup()">Text search</button>
        <br>
        <label>Switch to AI Item recognition?</label>
        <input type="checkbox" id="scan_mode" onchange="toggle_scan_mode()">
        <br>
        <!-- Video stream from backend (MJPEG stream) -->
        <!-- Webcam preview -->
        <video id="camera" autoplay playsinline></video>

        <!-- Hidden canvas for capturing frames -->
        <canvas id="snapshot" style="display:none;"></canvas>
    </div>

    <div id="not_found_popup" class="popup">
        <h2>Item Not Found</h2>
        <button id="close_not_found_popup" onclick="close_not_found_popup()">×</button>
        <p>The item scanned was not found in the database.</p>
        <button id="open_not_found_button">Add Missing Item</button>
    </div>

    <div id="search_popup" class="popup">
        <h2 id="search-popup-title">Search for item</h2>
        <button id="close_search_popup" onclick="close_search_popup()">×</button>
        <form id="search-form" method="POST" onsubmit="text_search_item(event)">
            <input type="text" spellcheck="true" id="search_term" name="search_term" placeholder="Enter item name..." required>
            <button type="submit">Search</button>
        </form>
        <div id="search_results"></div>
        <button onclick="open_add_popup('search')">Add Missing Item</button>
    </div>

    <div id="popup" class="popup">
        <h2 id="inv-popup-title">Add Item To Inventory</h2>
        <button id="close-popup" onclick="close_item_popup(false)">×</button>
        <form id="update-form" method="POST" onsubmit="add_item(event)">
            <label>Barcode:</label>
            <input type="text" id="barcode" name="barcode" readonly>
            <br>
            <label>Item Name:</label>
            <input type="text" id="name" name="name" readonly>
            <br>
            <label>Brand:</label>
            <input type="text" id="brand" name="brand" readonly>
            <br>
            <label>Expiry Date:</label>
            <input type="date" id="expiry_date" name="expiry_date" required>
            <br>
            <label>Quantity:</label>
            <input type="number" id="quantity" name="quantity" min="1" required>
            <br>
            <label>Unit:</label>
            <input type="text" id="unit" name="unit" readonly>
            <br>
            <input type="hidden" id="item_id" name="item_id">
            <input type="hidden" id="expiry_time" name="expiry_time">
            <button type="submit">Add Item</button>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/barcode_scan.js') }}"></script>
{% endblock %}
